---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { uniqBy, sortBy } from "lodash-es";
import TitleWithNavigation from "../../components/TitleWithNavigation.astro";
import RaceSelector from "../../components/RaceSelector.astro";

export async function getStaticPaths() {
  const seasons = await getCollection("seasons");
  return seasons.map(({ id }) => ({
    params: { season: id },
  }));
}

const { season: seasonStr } = Astro.params;

const season = parseInt(seasonStr);

const allSeasons = await getCollection("seasons");
const previousSeason = allSeasons.find(({ data: { id } }) => id === season - 1);
const nextSeason = allSeasons.find(({ data: { id } }) => id === season + 1);
---

<Layout>
  <TitleWithNavigation
    previous={previousSeason ? `/seasons/${previousSeason.data.id}` : undefined}
    next={nextSeason ? `/seasons/${nextSeason.data.id}` : undefined}
    title={`${season} season`}
  />

  <RaceSelector season={season} />
</Layout>
